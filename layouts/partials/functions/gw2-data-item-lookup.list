{{- $context := 0 | index . -}}
{{- $type := 1 | index . -}}
{{- $stat := 2 | index . -}}
{{- $profession := 3 | index . | lower -}}

{{- $data := slice -}}

{{- $itemTable := slice $context | partialCached "functions/gw2-data-item-table.dict" -}}
{{- $typeTable := slice $context | partialCached "functions/gw2-data-item-type-lookup.dict" -}}

{{- with $type | slice $context | partial "functions/gw2-data-slugify.string" | index $typeTable | default $type -}}
    {{- $items := where $itemTable "type" . -}}

    {{- if $stat | string | eq $stat -}}
        {{- with $stat | slice $context | partial "functions/gw2-data-slugify.string" -}}
            {{- $items = where $items "statslug" . -}}
        {{- end -}}
    {{- else -}}
        {{- $items = where $items "stat" $stat -}}
    {{- end -}}

    {{- with $profession | slice $context | partial "functions/gw2-data-profession-name-to-weight-class.string" -}}
        {{- $items = where $items "weight" . -}}
    {{- end -}}

    {{- $data = $data | append $items -}}
{{- end -}}

{{- return $data -}}
