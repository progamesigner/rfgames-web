{{- $context := 0 | index . -}}
{{- $url := 1 | index . -}}
{{- $ids := 2 | index . | default slice -}}
{{- $page := 3 | index . | default 1 -}}
{{- $count := 4 | index . | default 200 -}}

{{- $offset := 1 | sub $page | mul $count -}}
{{- $fetchIds := $ids | after $offset | first $count -}}

{{- $data := slice }}
{{- if $fetchIds | len | lt 0 -}}
    {{- $data = delimit $fetchIds "," | dict "ids" | slice $context $url | partial "functions/gw2-api-url.string" | getJSON -}}

    {{- $nextPage := $page | add 1 -}}
    {{- $chunk := slice $context $url $fetchIds $nextPage $count | partial "functions/gw2-api-paginated-data-by-ids.list" -}}
    {{- $data = $data | append $chunk -}}
{{- end -}}

{{- return $data -}}
