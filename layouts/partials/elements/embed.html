{{- $type := 0 | index . | lower -}}
{{- $inline := 1 | index . | default false -}}
{{- $data := 2 | index . | default dict -}}
{{- $class := 3 | index . | default slice -}}

{{- $data = $type | dict "type" | merge $data -}}
{{- $data = $inline | string | dict "inline" | merge $data -}}

{{- $classes := slice -}}
{{- $classes = $classes | append "gw2-embed" -}}
{{- with $inline -}}
    {{- $classes = $classes | append "is-inline" -}}
{{- end -}}
{{- with $type | printf "is-%s" -}}
    {{- $classes = $classes | append . -}}
{{- end -}}
{{- with $class -}}
    {{- $classes = $classes | append . -}}
{{- end -}}

{{- $attributes := dict -}}
{{- $attributes = delimit $classes " " | dict "class" | merge $attributes -}}
{{- range $key, $value := $data -}}
    {{- $attribute := $key | printf "data-embed-%s" -}}
    {{- $attributes = $value | string | dict $attribute | merge $attributes -}}
{{- end -}}

{{- if $inline -}}
    <span
        {{ range $key, $value := $attributes }}
            {{ printf "%s=%q" $key $value | safeHTMLAttr }}
        {{ end }}
    >
        {{- with "text" | index $data -}}
            <span class="gw2-embed-inline-placeholder"></span>{{- . -}}
        {{- else -}}
            &nbsp;
        {{- end -}}
    </span>
{{- else -}}
    <div
        {{ range $key, $value := $attributes }}
            {{ printf "%s=%q" $key $value | safeHTMLAttr }}
        {{ end }}
    >
    </div>
{{- end -}}
